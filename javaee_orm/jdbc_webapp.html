

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="fr" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="fr" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>JDBC dans une application Web &mdash; Documentation Java ORM </title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_rtd_theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Les EJB" href="ejb.html" />
    <link rel="prev" title="L’héritage avec JPA" href="jpa_inheritance.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Java ORM
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Recherche dans les pages" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Java EE ORM</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="jdbc.html">Accès aux bases de données : JDBC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#preambule-try-with-resources">Préambule : try-with-resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#le-pilote-de-base-de-donnees">Le pilote de base de données</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#creation-d-une-connexion">Création d’une connexion</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#l-url-de-connexion-et-la-classe-des-pilotes">L’URL de connexion et la classe des pilotes</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#les-requetes-sql-statement">Les requêtes SQL (Statement)</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#le-statement">Le Statement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jdbc.html#exercice">Exercice</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#le-resultset">Le ResultSet</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jdbc.html#id1">Exercice</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#le-preparedstatement">Le PreparedStatement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jdbc.html#id2">Exercice</a></li>
<li class="toctree-l3"><a class="reference internal" href="jdbc.html#l-injection-sql">L’injection SQL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#le-callablestatement">Le CallableStatement</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbc.html#la-transaction">La transaction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jpa_entites.html">Les entités JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jpa_entites.html#les-orm-object-relational-mapping">Les ORM (Object-Relational Mapping)</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_entites.html#id1">Les entités JPA</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_entites.html#l-entitymanager">L’EntityManager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#obtenir-un-entitymanager">Obtenir un EntityManager</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#creer-une-fabrique-d-entitymanager">Créer une fabrique d’EntityManager</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jpa_entites.html#manipuler-des-entites-a-partir-d-un-entitymanager">Manipuler des entités à partir d’un EntityManager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-persist">La méthode persist</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-find">La méthode find</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-refresh">La méthode refresh</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-merge">La méthode merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-detach">La méthode detach</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_entites.html#la-methode-remove">La méthode remove</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jpa_queries.html">Les requêtes JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jpa_queries.html#les-requetes-natives">Les requêtes Natives</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_queries.html#les-requetes-jpql">Les requêtes JPQL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_queries.html#exercice">Exercice</a></li>
<li class="toctree-l3"><a class="reference internal" href="jpa_queries.html#les-requetes-par-programmation">Les requêtes par programmation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jpa_queries.html#utilisation-de-requetes-nommees">Utilisation de requêtes nommées</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jpa_relations.html">Les relations avec JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jpa_relations.html#la-relation-1-1-one-to-one">La relation 1:1 (one to one)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_relations.html#exercice">Exercice</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jpa_relations.html#la-relation-n-1-many-to-one">La relation n:1 (many to one)</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_relations.html#la-relation-1-n-one-to-many">La relation 1:n (one to many)</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_relations.html#la-relation-n-n-many-to-many">La relation n:n (many to many)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_relations.html#id1">Exercice</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jpa_relations.html#les-relations-bi-directionnelles">Les relations bi-directionnelles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_relations.html#id2">Exercice</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jpa_relations.html#la-propagation-en-cascade">La propagation en cascade</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_relations.html#id3">Exercice</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jpa_relations.html#requetes-jpql-et-jointure">Requêtes JPQL et jointure</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_relations.html#fetch-lazy-ou-fetch-eager">Fetch lazy ou fetch eager</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jpa_inheritance.html">L’héritage avec JPA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jpa_inheritance.html#l-annotation-inheritance">L’annotation &#64;Inheritance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jpa_inheritance.html#heritage-avec-une-seule-table">Héritage avec une seule table</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jpa_inheritance.html#heritage-avec-jointure-de-tables">Héritage avec jointure de tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_inheritance.html#heritage-avec-une-table-par-classe">Héritage avec une table par classe</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_inheritance.html#l-heritage-et-les-requetes-jpql-polymorphiques">L’héritage et les requêtes JPQL polymorphiques</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_inheritance.html#un-cas-a-part-fusion-de-la-super-classe">Un cas à part : fusion de la super classe</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">JDBC dans une application Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#declaration-d-une-datasource">Déclaration d’une DataSource</a></li>
<li class="toctree-l2"><a class="reference internal" href="#declaration-d-une-datasource-dans-wildfly">Déclaration d’une DataSource dans Wildfly</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#deploiement-automatique-du-driver-mysql-methode-1">Déploiement automatique du driver MySQL (méthode 1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ajout-du-driver-mysql-comme-nouveau-module-methode-2">Ajout du driver MySQL comme nouveau module (méthode 2)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ejb.html">Les EJB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ejb.html#le-conteneur-d-ejb">Le conteneur d’EJB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ejb.html#les-types-d-ejb">Les types d’EJB</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ejb.html#les-ejb-session">Les EJB session</a></li>
<li class="toctree-l2"><a class="reference internal" href="ejb.html#ejb-session-stateful">EJB session stateful</a></li>
<li class="toctree-l2"><a class="reference internal" href="ejb.html#ejb-session-stateless">EJB session stateless</a></li>
<li class="toctree-l2"><a class="reference internal" href="ejb.html#ejb-session-singleton">EJB session singleton</a></li>
<li class="toctree-l2"><a class="reference internal" href="ejb.html#methodes-de-cycle-de-vie">Méthodes de cycle de vie</a></li>
<li class="toctree-l2"><a class="reference internal" href="ejb.html#acces-a-un-ejb-session">Accès à un EJB session</a></li>
<li class="toctree-l2"><a class="reference internal" href="ejb.html#ejb-et-interface-metier">EJB et interface métier</a></li>
<li class="toctree-l2"><a class="reference internal" href="ejb.html#la-gestion-des-transactions">La gestion des transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ejb.html#jta-java-transaction-api">JTA (Java Transaction API)</a></li>
<li class="toctree-l3"><a class="reference internal" href="ejb.html#la-demarcation-transactionnelle">La démarcation transactionnelle</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jpa_webapp.html">JPA dans une application Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="jpa_webapp.html#obtenir-un-entitymanager-dans-un-serveur-java-ee">Obtenir un EntityManager dans un serveur Java EE</a></li>
<li class="toctree-l2"><a class="reference internal" href="jpa_webapp.html#jpa-et-jta">JPA et JTA</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Java ORM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Accueil</a> &raquo;</li>
        
      <li>JDBC dans une application Web</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="ejb.html" class="btn btn-neutral float-right" title="Les EJB" accesskey="n">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="jpa_inheritance.html" class="btn btn-neutral" title="L’héritage avec JPA" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="jdbc-dans-une-application-web">
<h1>JDBC dans une application Web<a class="headerlink" href="#jdbc-dans-une-application-web" title="Lien permanent vers ce titre">¶</a></h1>
<p>JDBC (Java DataBase Connectivity) est l’API standard pour interagir avec les
bases données relationnelles en Java. Cette API peut être utilisée dans une
application Web.</p>
<div class="section" id="declaration-d-une-datasource">
<span id="datasource-ref"></span><h2>Déclaration d’une DataSource<a class="headerlink" href="#declaration-d-une-datasource" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans un serveur d’application, l’utilisation du <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/java/sql/DriverManager.html">DriverManager</a> JDBC est remplacée
par celle de la <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/javax/sql/DataSource.html">DataSource</a>. L’interface <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/javax/sql/DataSource.html">DataSource</a> n’offre que deux méthodes :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Attempts to establish a connection with the data source</span>
<span class="n">Connection</span> <span class="nf">getConnection</span><span class="o">()</span>

<span class="c1">// Attempts to establish a connection with the data source</span>
<span class="n">Connection</span> <span class="nf">getConnection</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span>
</pre></div>
</div>
<p>Il n’est pas possible de spécifier l’URL de connection à la base de données
avec une <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/javax/sql/DataSource.html">DataSource</a>. Par contre une <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/javax/sql/DataSource.html">DataSource</a> peut être injectée dans
n’importe quel composant Java EE grâce à l’annotation <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/annotation/Resource.html">Resource</a> :</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Injection d’une DataSource dans une Servlet</span><a class="headerlink" href="#id1" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.annotation.Resource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.annotation.WebServlet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="nd">@WebServlet</span><span class="o">(</span><span class="s">&quot;/MyServlet&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>

  <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;nomDeLaDataSource&quot;</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
                          <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>

    <span class="k">try</span> <span class="o">(</span><span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">())</span> <span class="o">{</span>
      <span class="c1">// ...</span>
    <span class="o">}</span>

  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<p>L’annotation <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/annotation/Resource.html">Resource</a> permet de spécifier le nom de la <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/javax/sql/DataSource.html">DataSource</a> grâce à
l’attribut <em>name</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>L’annotation <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/annotation/Resource.html">Resource</a> se base sur <strong>JNDI</strong> (Java Naming and Directory
Interface) pour rechercher la <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/javax/sql/DataSource.html">DataSource</a> demandée. JNDI est une API standard
de Java permettant de se connecter à des annuaires (notamment les annuaires
LDAP). Les serveurs d’application Java EE disposent de leur propre implémentation
interne d’annuaire permettant de stocker des instances d’objet.</p>
<p>Les ressources telles que les <em>DataSources</em> sont donc stockées dans un annuaire
interne et il est possible d’y accéder avec l’API JNDI. Les ressources sont
classées dans une arborescence (comme le sont les fichiers dans un système
de fichiers). Une ressource est stockée dans l’arborescence <strong>java:/comp/env</strong>.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Exemple de récupération d’une DataSource en utilisant l’API JNDI</span><a class="headerlink" href="#id2" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// javax.naming.InitialContext désigne le contexte racine de l&#39;annuaire.</span>
<span class="c1">// Un annuaire JDNI est constitué d&#39;instances de javax.naming.Context</span>
<span class="c1">// (qui sont l&#39;équivalent des répertoires dans un système de fichiers).</span>
<span class="n">Context</span> <span class="n">envContext</span> <span class="o">=</span> <span class="n">InitialContext</span><span class="o">.</span><span class="na">doLookup</span><span class="o">(</span><span class="s">&quot;java:/comp/env&quot;</span><span class="o">);</span>

<span class="c1">// On récupère la source de données dans le contexte java:/comp/env</span>
<span class="n">DataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">DataSource</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">envContext</span><span class="o">.</span><span class="na">lookup</span><span class="o">(</span><span class="s">&quot;nomDeLaDataSource&quot;</span><span class="o">));</span>
</pre></div>
</div>
</div>
<p>Le contexte JNDI <strong>java:/comp/env</strong> est un contexte particulier. Il désigne
l’ensemble des composants Java EE disponibles dans l’environnement (env) du
composant Java EE (comp) courant.</p>
</div>
</div>
<div class="section" id="declaration-d-une-datasource-dans-wildfly">
<h2>Déclaration d’une DataSource dans Wildfly<a class="headerlink" href="#declaration-d-une-datasource-dans-wildfly" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une connexion JDBC est réalisée à travers un pilote. Pour déclarer une <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/javax/sql/DataSource.html">DataSource</a>
vers une base de données MySQL par exemple, nous devons installer le pilote
MySQL dans le serveur.</p>
<p>Ce système de configuration est certes plus compliqué que l’utilisation du
<a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/java/sql/DriverManager.html">DriverManager</a> mais il permet à l’application d’ignorer les détails de
configuration. Généralement le développeur de l’application référence une <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/javax/sql/DataSource.html">DataSource</a>
et c’est l’administrateur du serveur qui configure la connexion de cette <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/javax/sql/DataSource.html">DataSource</a>
vers une base de données spécifiques.</p>
<p>L’utilisation des <em>DataSources</em> dans un serveur d’application
apporte également des fonctionnalités supplémentaires telles que la mise en
cache et la réutilisation de connexions (pour améliorer les performances),
les tests permettant de vérifier que les connexions sont correctement
établies, la supervision des connexions…</p>
<p>Pour ajouter ce pilote dans Wildfly, nous pouvons :</p>
<ul class="simple">
<li><p>soit laisser le serveur le faire grâce à une procédure de déploiement
automatisé.</p></li>
<li><p>soit ajouter un nouveau module dans le serveur</p></li>
</ul>
<p>Les sections suivantes décrivent respectivement ces méthodes. La première méthode
est assez simple à réaliser et elle est donc recommandée pour commencer.
La seconde, plus complexe, donne plus d’options de configuration à l’administrateur du serveur.</p>
<div class="section" id="deploiement-automatique-du-driver-mysql-methode-1">
<h3>Déploiement automatique du driver MySQL (méthode 1)<a class="headerlink" href="#deploiement-automatique-du-driver-mysql-methode-1" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Vous pouvez télécharger le driver MySQL pour JDBC
<a class="reference external" href="https://mvnrepository.com/artifact/mysql/mysql-connector-java">ici selon la version</a>.</p>
</div>
<p>Pour déployer automatiquement le pilote MySQL dans Wildfly, il suffit de placer
le fichier <em>jar</em> du pilote dans le répertoire <code class="file docutils literal notranslate"><span class="pre">standalone/deployments/</span></code>
depuis le répertoire d’installation du serveur.</p>
<p>Démarrez ensuite votre serveur et scrutez dans les logs de démarrage du serveur
la trace qui indique le déploiement par le serveur. Pour MySQL, vous devriez avoir
une ligne de log telle que :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>09:51:40,222 INFO  [org.jboss.as.connector.deployers.jdbc] (MSC service thread 1-4) WFLYJCA0018: Started Driver service with driver-name = mysql-connector-java-5.1.47.jar_com.mysql.jdbc.Driver_5_1
</pre></div>
</div>
<p>Cette ligne (un peu longue) indique tout au bout le nom attribué automatiquement
au driver par le serveur au démarrage. Pour l’exemple ci-dessus, le nom est
<strong>mysql-connector-java-5.1.47.jar_com.mysql.jdbc.Driver_5_1</strong>. Mais attention
ce nom peut être différent pour votre configuration.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remarquez que le répertoire <code class="file docutils literal notranslate"><span class="pre">standalone/deployments/</span></code> dans lequel vous
avez placé le driver de base de données contient également les fichiers <em>war</em>
des applications que vous avez déjà déployées. Ce répertoire est scruté en
permanence par le serveur et il déploie les modules qui sont copiés dedans.</p>
</div>
<p>Une fois, le pilote déployé automatiquement par le serveur, il est possible
de déclarer la <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/javax/sql/DataSource.html">DataSource</a> dans le fichier <code class="file docutils literal notranslate"><span class="pre">standalone/configuration/standalone.xml</span></code>.
Au alentour de la ligne 140 dans ce fichier, on trouve la section de déclaration
des pilotes de base de données et des sources de données :</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Ajout d’une source de données dans le fichier standalone.xml</span><a class="headerlink" href="#id4" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="nt">&lt;subsystem</span> <span class="na">xmlns=</span><span class="s">&quot;urn:jboss:domain:datasources:5.0&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;datasources&gt;</span>
          <span class="nt">&lt;datasource</span> <span class="na">jndi-name=</span><span class="s">&quot;java:jboss/datasources/ExampleDS&quot;</span> <span class="na">pool-name=</span><span class="s">&quot;ExampleDS&quot;</span> <span class="na">enabled=</span><span class="s">&quot;true&quot;</span> <span class="na">use-java-context=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;connection-url&gt;</span>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE<span class="nt">&lt;/connection-url&gt;</span>
              <span class="nt">&lt;driver&gt;</span>h2<span class="nt">&lt;/driver&gt;</span>
              <span class="nt">&lt;security&gt;</span>
                  <span class="nt">&lt;user-name&gt;</span>sa<span class="nt">&lt;/user-name&gt;</span>
                  <span class="nt">&lt;password&gt;</span>sa<span class="nt">&lt;/password&gt;</span>
              <span class="nt">&lt;/security&gt;</span>
          <span class="nt">&lt;/datasource&gt;</span>
<span class="hll">          <span class="nt">&lt;datasource</span> <span class="na">jta=</span><span class="s">&quot;true&quot;</span> <span class="na">jndi-name=</span><span class="s">&quot;java:/nomDeLaDataSource&quot;</span> <span class="na">pool-name=</span><span class="s">&quot;nomDeLaDataSource&quot;</span> <span class="na">enabled=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">              <span class="nt">&lt;connection-url&gt;</span>jdbc:mysql://[HOST]:[PORT]/[NOM SCHEMA]<span class="nt">&lt;/connection-url&gt;</span>
</span><span class="hll">              <span class="nt">&lt;driver&gt;</span>mysql-connector-java-5.1.47.jar_com.mysql.jdbc.Driver_5_1<span class="nt">&lt;/driver&gt;</span>
</span><span class="hll">              <span class="nt">&lt;security&gt;</span>
</span><span class="hll">                  <span class="nt">&lt;user-name&gt;</span>[LOGIN]<span class="nt">&lt;/user-name&gt;</span>
</span><span class="hll">                  <span class="nt">&lt;password&gt;</span>[PASSWORD]<span class="nt">&lt;/password&gt;</span>
</span><span class="hll">              <span class="nt">&lt;/security&gt;</span>
</span><span class="hll">          <span class="nt">&lt;/datasource&gt;</span>
</span>          <span class="nt">&lt;drivers&gt;</span>
              <span class="nt">&lt;driver</span> <span class="na">name=</span><span class="s">&quot;h2&quot;</span> <span class="na">module=</span><span class="s">&quot;com.h2database.h2&quot;</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;xa-datasource-class&gt;</span>org.h2.jdbcx.JdbcDataSource<span class="nt">&lt;/xa-datasource-class&gt;</span>
              <span class="nt">&lt;/driver&gt;</span>
          <span class="nt">&lt;/drivers&gt;</span>
      <span class="nt">&lt;/datasources&gt;</span>
  <span class="nt">&lt;/subsystem&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<p>À la ligne 153, on indique le driver de base de données à utiliser en donnant
le nom du driver déployé automatiquement par le serveur.</p>
</div>
<div class="section" id="ajout-du-driver-mysql-comme-nouveau-module-methode-2">
<h3>Ajout du driver MySQL comme nouveau module (méthode 2)<a class="headerlink" href="#ajout-du-driver-mysql-comme-nouveau-module-methode-2" title="Lien permanent vers ce titre">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Vous pouvez télécharger le driver MySQL pour JDBC
<a class="reference external" href="https://mvnrepository.com/artifact/mysql/mysql-connector-java">ici selon la version</a>.</p>
</div>
<p>Pour ajouter le pilote MySQL dans Wildfly, nous pouvons créer un nouveau module dans le serveur.
Pour cela, à partir du répertoire d’installation du serveur lui-même, placez
le fichier <em>jar</em> du pilote dans le répertoire <code class="file docutils literal notranslate"><span class="pre">modules/system/layers/base/com/mysql/driver/main</span></code>.
Créez les répertoires manquants si nécessaire.</p>
<p>Créez ensuite le fichier <code class="file docutils literal notranslate"><span class="pre">module.xml</span></code> dans le répertoire
<code class="file docutils literal notranslate"><span class="pre">modules/system/layers/base/com/mysql/driver/main</span></code>. Ce fichier doit pointer
sur le fichier <em>jar</em> du pilote :</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Fichier module.xml</span><a class="headerlink" href="#id5" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
<span class="nt">&lt;module</span> <span class="na">xmlns=</span><span class="s">&quot;urn:jboss:module:1.5&quot;</span> <span class="na">name=</span><span class="s">&quot;com.mysql.driver&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;resources&gt;</span>
    <span class="c">&lt;!-- Indiquez le chemin vers le fichier jar du pilote --&gt;</span>
    <span class="nt">&lt;resource-root</span> <span class="na">path=</span><span class="s">&quot;mysql-connector-java-X.X.X.jar&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/resources&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;javax.api&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;javax.transaction.api&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;javax.servlet.api&quot;</span> <span class="na">optional=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;javax.ws.rs.api&quot;</span> <span class="na">optional=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/module&gt;</span>
</pre></div>
</div>
</div>
<p>Une fois, le pilote déclaré comme un module dans le serveur, il est possible
de déclarer la <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/javax/sql/DataSource.html">DataSource</a> dans le fichier <code class="file docutils literal notranslate"><span class="pre">standalone/configuration/standalone.xml</span></code>.
Au alentour de la ligne 140 dans ce fichier, on trouve la section de déclaration
des pilotes de base de données et des sources de données :</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Ajout d’une source de données dans le fichier standalone.xml</span><a class="headerlink" href="#id6" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="nt">&lt;subsystem</span> <span class="na">xmlns=</span><span class="s">&quot;urn:jboss:domain:datasources:5.0&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;datasources&gt;</span>
          <span class="nt">&lt;datasource</span> <span class="na">jndi-name=</span><span class="s">&quot;java:jboss/datasources/ExampleDS&quot;</span> <span class="na">pool-name=</span><span class="s">&quot;ExampleDS&quot;</span> <span class="na">enabled=</span><span class="s">&quot;true&quot;</span> <span class="na">use-java-context=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;connection-url&gt;</span>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE<span class="nt">&lt;/connection-url&gt;</span>
              <span class="nt">&lt;driver&gt;</span>h2<span class="nt">&lt;/driver&gt;</span>
              <span class="nt">&lt;security&gt;</span>
                  <span class="nt">&lt;user-name&gt;</span>sa<span class="nt">&lt;/user-name&gt;</span>
                  <span class="nt">&lt;password&gt;</span>sa<span class="nt">&lt;/password&gt;</span>
              <span class="nt">&lt;/security&gt;</span>
          <span class="nt">&lt;/datasource&gt;</span>
<span class="hll">          <span class="nt">&lt;datasource</span> <span class="na">jta=</span><span class="s">&quot;true&quot;</span> <span class="na">jndi-name=</span><span class="s">&quot;java:/nomDeLaDataSource&quot;</span> <span class="na">pool-name=</span><span class="s">&quot;nomDeLaDataSource&quot;</span> <span class="na">enabled=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">              <span class="nt">&lt;connection-url&gt;</span>jdbc:mysql://[HOST]:[PORT]/[NOM SCHEMA]<span class="nt">&lt;/connection-url&gt;</span>
</span><span class="hll">              <span class="nt">&lt;driver&gt;</span>mysql<span class="nt">&lt;/driver&gt;</span>
</span><span class="hll">              <span class="nt">&lt;security&gt;</span>
</span><span class="hll">                  <span class="nt">&lt;user-name&gt;</span>[LOGIN]<span class="nt">&lt;/user-name&gt;</span>
</span><span class="hll">                  <span class="nt">&lt;password&gt;</span>[PASSWORD]<span class="nt">&lt;/password&gt;</span>
</span><span class="hll">              <span class="nt">&lt;/security&gt;</span>
</span><span class="hll">          <span class="nt">&lt;/datasource&gt;</span>
</span>          <span class="nt">&lt;drivers&gt;</span>
              <span class="nt">&lt;driver</span> <span class="na">name=</span><span class="s">&quot;h2&quot;</span> <span class="na">module=</span><span class="s">&quot;com.h2database.h2&quot;</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;xa-datasource-class&gt;</span>org.h2.jdbcx.JdbcDataSource<span class="nt">&lt;/xa-datasource-class&gt;</span>
              <span class="nt">&lt;/driver&gt;</span>
<span class="hll">              <span class="nt">&lt;driver</span> <span class="na">name=</span><span class="s">&quot;mysql&quot;</span> <span class="na">module=</span><span class="s">&quot;com.mysql.driver&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">                  <span class="nt">&lt;driver-class&gt;</span>com.mysql.jdbc.Driver<span class="nt">&lt;/driver-class&gt;</span>
</span><span class="hll">              <span class="nt">&lt;/driver&gt;</span>
</span>          <span class="nt">&lt;/drivers&gt;</span>
      <span class="nt">&lt;/datasources&gt;</span>
  <span class="nt">&lt;/subsystem&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ejb.html" class="btn btn-neutral float-right" title="Les EJB" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="jpa_inheritance.html" class="btn btn-neutral float-left" title="L’héritage avec JPA" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Précédent</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright David Gayerie - david.gayerie@epsi.fr - CC-BY-SA

    </p>
  </div>
    <div><a class="reference download" href="https://github.com/spoonless/epsi-b3-orm/archive/gh-pages.zip"><code class="download docutils literal notranslate"><span class="pre">Télécharger ce cours</pre></code></a></div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>